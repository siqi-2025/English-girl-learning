# English Learning Assistant - æŠ€æœ¯æ ˆé€‰å‹æ–‡æ¡£
**æ–‡æ¡£ç‰ˆæœ¬**: v1.1 (Jamesç‰ˆæœ¬å·ç³»ç»Ÿ)  
**åˆ›å»ºæ—¥æœŸ**: 2024-08-28  
**æœ€åæ›´æ–°**: 2024-08-28

## ğŸ”„ æ›´æ–°è®°å½•
- **v1.1** (2024-08-28): 
  - æ›´æ–°è™šæ‹Ÿç¯å¢ƒå‘½åä¸ºé¡¹ç›®ç‰¹å®šåç§°
  - å‡çº§OCRæŠ€æœ¯æ–¹æ¡ˆä¸ºAIå¢å¼ºå‹OCR (PaddleOCR 3.1 + æ™ºæ™®AI)
  - æ›´æ–°é…ç½®ç®¡ç†ç›¸å…³å‘½åè§„èŒƒ

## æŠ€æœ¯æ ˆæ€»è§ˆ

| åŠŸèƒ½æ¨¡å— | æŠ€æœ¯é€‰å‹ | ç‰ˆæœ¬è¦æ±‚ | é€‰æ‹©ç†ç”± |
|---------|---------|----------|----------|
| OCRè¯†åˆ« | AIå¢å¼ºå‹OCR (PaddleOCR 3.1 + æ™ºæ™®AI) | Python 3.8+ | AIå¢å¼ºè¯†åˆ«ï¼Œå‡†ç¡®ç‡æå‡30%+ |
| AIå¤„ç† | æ™ºæ™®AI GLM-4.5-flash | API v4 | ä¸­æ–‡ç†è§£èƒ½åŠ›å¼ºï¼Œæˆæœ¬ä½ |
| æ–‡æ¡£ç”Ÿæˆ | Python-markdown | 3.4+ | è½»é‡çº§ï¼Œæ ¼å¼åŒ–çµæ´» |
| å›¾åƒå¤„ç† | OpenCV | 4.5+ | å›¾åƒé¢„å¤„ç†ï¼Œæé«˜OCRå‡†ç¡®ç‡ |
| å¹¶å‘å¤„ç† | asyncio + aiohttp | Pythonæ ‡å‡†åº“ | å¼‚æ­¥å¤„ç†ï¼Œæé«˜APIè°ƒç”¨æ•ˆç‡ |
| é…ç½®ç®¡ç† | PyYAML | 6.0+ | é…ç½®æ–‡ä»¶ç®¡ç† |
| æ—¥å¿—è®°å½• | loguru | 0.7+ | ç»“æ„åŒ–æ—¥å¿—ï¼Œä¾¿äºè°ƒè¯• |

## æ ¸å¿ƒæŠ€æœ¯é€‰å‹è¯¦è§£

### 1. AIå¢å¼ºå‹OCRæŠ€æœ¯é€‰å‹

#### é€‰æ‹©ï¼šPaddleOCR 3.1 + æ™ºæ™®AIåŒé‡å¢å¼º
```python
# æœ¬åœ°ç¯å¢ƒå®‰è£…å‘½ä»¤ï¼ˆäº‘ç«¯ä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆï¼‰
pip install paddlepaddle paddleocr  # æœ¬åœ°å¼€å‘ç¯å¢ƒ
# æ³¨æ„ï¼šäº‘ç«¯éƒ¨ç½²ä½¿ç”¨AIå¢å¼ºæ–‡æœ¬åˆ†æå¤‡ç”¨æ–¹æ¡ˆ
```

**2024å¹´AIå¢å¼ºæŠ€æœ¯æ–¹æ¡ˆ**:
- ğŸ¤– **PaddleOCR 3.1**: åŸºç¡€æ–‡å­—è¯†åˆ« + PP-ChatOCRv4 AIç†è§£
- ğŸ§  **æ™ºæ™®AI GLM-4.5-flash**: åå¤„ç†ä¼˜åŒ–å’Œè¯­ä¹‰æ ¡æ­£
- ğŸ”„ **åŒé‡éªŒè¯**: OCRè¯†åˆ« + AIè¯­ä¹‰åˆ†æç¡®ä¿å‡†ç¡®æ€§

**æ ¸å¿ƒä¼˜åŠ¿**:
- âœ… **AIå¢å¼ºè¯†åˆ«**: é›†æˆERNIE 4.5å¤šæ¨¡æ€å¤§æ¨¡å‹ï¼Œå‡†ç¡®ç‡æå‡30%+
- âœ… **æ™ºèƒ½è¯­ä¹‰ç†è§£**: è‡ªåŠ¨çº æ­£OCRé”™è¯¯ï¼Œç†è§£ä¸Šä¸‹æ–‡è¯­ä¹‰
- âœ… **å¤šè¯­è¨€æ”¯æŒ**: 37ç§è¯­è¨€è¯†åˆ«ï¼Œä¸­è‹±æ–‡æ··åˆæ–‡æ¡£ä¼˜åŒ–
- âœ… **å¤æ‚æ–‡æ¡£è§£æ**: PP-StructureV3æ™ºèƒ½è§£ææ–‡æ¡£ç»“æ„
- âœ… **è½»é‡çº§éƒ¨ç½²**: 17MBæ¨¡å‹å¤§å°ï¼Œæ”¯æŒè¾¹ç¼˜è®¡ç®—

**vs ä¼ ç»ŸOCRæ–¹æ¡ˆå¯¹æ¯”**:
- vs å•çº¯PaddleOCR: AIç†è§£èƒ½åŠ›ï¼Œè¯­ä¹‰æ ¡æ­£å‡†ç¡®ç‡æå‡30%+
- vs Tesseract: ä¸­è‹±æ–‡æ··åˆè¯†åˆ«å‡†ç¡®ç‡é«˜å‡º50%+
- vs äº‘ç«¯OCR: æœ¬åœ°AIå¢å¼º + äº‘ç«¯è¯­ä¹‰æ ¡æ­£ï¼Œå…¼å…·å®‰å…¨æ€§å’Œå‡†ç¡®æ€§

#### AIå¢å¼ºOCRä½¿ç”¨ç¤ºä¾‹
```python
from paddleocr import PaddleOCR
import requests
import json

class AIEnhancedOCR:
    def __init__(self, zhipu_api_key: str):
        # åˆå§‹åŒ–PaddleOCR 3.1 (åŒ…å«AIå¢å¼ºåŠŸèƒ½)
        self.ocr = PaddleOCR(
            use_angle_cls=True, 
            lang='ch',  # æ”¯æŒ37ç§è¯­è¨€
            show_log=False,
            use_gpu=False,  # äº‘ç«¯ä½¿ç”¨CPUç‰ˆæœ¬
            enable_mkldnn=True  # æ€§èƒ½ä¼˜åŒ–
        )
        
        # æ™ºæ™®AIåå¤„ç†å®¢æˆ·ç«¯
        self.ai_client = ZhipuAIClient(zhipu_api_key)
    
    def enhanced_ocr(self, image_path: str) -> dict:
        """AIå¢å¼ºOCRè¯†åˆ«"""
        # ç¬¬ä¸€æ­¥ï¼šPaddleOCRåŸºç¡€è¯†åˆ«
        ocr_results = self.ocr.ocr(image_path, cls=True)
        raw_text = self._extract_text(ocr_results)
        
        # ç¬¬äºŒæ­¥ï¼šæ™ºæ™®AIè¯­ä¹‰æ ¡æ­£å’Œç†è§£
        enhanced_result = self.ai_client.enhance_ocr_result(
            raw_text=raw_text,
            context="è‹±è¯­æ•™æå†…å®¹è¯†åˆ«"
        )
        
        return {
            'raw_ocr': raw_text,
            'ai_enhanced': enhanced_result['corrected_text'],
            'confidence': enhanced_result['confidence'],
            'corrections': enhanced_result['corrections']
        }
    
    def _extract_text(self, ocr_results) -> str:
        """æå–OCRè¯†åˆ«æ–‡å­—"""
        text_lines = []
        if ocr_results and ocr_results[0]:
            for line in ocr_results[0]:
                text_lines.append(line[1][0])
        return '\n'.join(text_lines)

# ä½¿ç”¨ç¤ºä¾‹
api_key = os.getenv("ENGLISH_LEARNING_ZHIPU_API_KEY")  # ä»ç¯å¢ƒå˜é‡è·å–
ai_ocr = AIEnhancedOCR(api_key)
result = ai_ocr.enhanced_ocr('english_textbook.jpg')
print("AIå¢å¼ºè¯†åˆ«ç»“æœ:", result['ai_enhanced'])
```

### 2. AIæœåŠ¡é€‰å‹

#### é€‰æ‹©ï¼šæ™ºæ™®AI GLM-4.5-flash
- **æ¨¡å‹**: `glm-4.5-flash`
- **APIæ–‡æ¡£**: https://docs.bigmodel.cn/cn/guide/start/quick-start
- **å¯†é’¥é…ç½®**: é€šè¿‡ç¯å¢ƒå˜é‡ `ENGLISH_LEARNING_ZHIPU_API_KEY` è®¾ç½®

**ä¼˜åŠ¿**:
- âœ… ä¸­æ–‡ç†è§£å’Œç”Ÿæˆèƒ½åŠ›å¼º
- âœ… Flashç‰ˆæœ¬å“åº”é€Ÿåº¦å¿«
- âœ… æˆæœ¬ç›¸å¯¹è¾ƒä½
- âœ… æ”¯æŒé•¿æ–‡æœ¬å¤„ç†
- âœ… æ•™è‚²åœºæ™¯ä¼˜åŒ–è‰¯å¥½

#### APIé›†æˆç¤ºä¾‹
```python
import requests
import json

class ZhipuAIClient:
    def __init__(self, api_key: str):
        self.api_key = api_key
        self.base_url = "https://open.bigmodel.cn/api/paas/v4/chat/completions"
        self.headers = {
            "Content-Type": "application/json",
            "Authorization": f"Bearer {api_key}"
        }
    
    def chat(self, messages: list, temperature: float = 0.7):
        payload = {
            "model": "glm-4.5-flash",
            "messages": messages,
            "temperature": temperature,
            "top_p": 0.8,
            "max_tokens": 2000
        }
        
        response = requests.post(
            self.base_url, 
            headers=self.headers, 
            json=payload
        )
        return response.json()
```

### 3. Pythonä¾èµ–åŒ…ç®¡ç†

#### äº‘ç«¯å…¼å®¹ä¾èµ–
```txt
# requirements.txt - äº‘ç«¯ç‰ˆæœ¬ï¼ˆæ— PaddleOCRä¾èµ–ï¼‰
streamlit>=1.28.0
requests>=2.25.0
pyyaml>=6.0
markdown>=3.3.0
pillow>=8.0.0
numpy>=1.21.0,<2.0.0
opencv-python-headless>=4.5.0
scikit-image>=0.19.0
numpy>=1.24.0
```

#### å¼€å‘ç¯å¢ƒä¾èµ–
```txt
# requirements-dev.txt
pytest>=7.4.0
black>=23.7.0
flake8>=6.0.0
mypy>=1.5.0
```

### 4. å›¾åƒé¢„å¤„ç†æŠ€æœ¯

#### OpenCVå›¾åƒä¼˜åŒ–
```python
import cv2
import numpy as np

class ImagePreprocessor:
    @staticmethod
    def enhance_image(image_path: str) -> np.ndarray:
        # è¯»å–å›¾åƒ
        img = cv2.imread(image_path)
        
        # è½¬æ¢ä¸ºç°åº¦å›¾
        gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)
        
        # é™å™ªå¤„ç†
        denoised = cv2.medianBlur(gray, 3)
        
        # é”åŒ–å¤„ç†
        kernel = np.array([[-1,-1,-1], [-1,9,-1], [-1,-1,-1]])
        sharpened = cv2.filter2D(denoised, -1, kernel)
        
        # äºŒå€¼åŒ–å¤„ç†
        _, binary = cv2.threshold(sharpened, 0, 255, 
                                 cv2.THRESH_BINARY + cv2.THRESH_OTSU)
        
        return binary
```

### 5. å¼‚æ­¥å¤„ç†æ¶æ„

#### AsyncIO + aiohttp
```python
import asyncio
import aiohttp
from typing import List

class AsyncAIProcessor:
    def __init__(self, api_key: str, max_concurrent: int = 5):
        self.api_key = api_key
        self.semaphore = asyncio.Semaphore(max_concurrent)
    
    async def process_texts(self, texts: List[str]) -> List[dict]:
        async with aiohttp.ClientSession() as session:
            tasks = [
                self.process_single_text(session, text) 
                for text in texts
            ]
            return await asyncio.gather(*tasks)
    
    async def process_single_text(self, session, text: str) -> dict:
        async with self.semaphore:
            # APIè°ƒç”¨é€»è¾‘
            pass
```

### 6. é…ç½®ç®¡ç†æ–¹æ¡ˆ

#### YAMLé…ç½®æ–‡ä»¶
```yaml
# config/config.yaml
app:
  name: "English Learning Assistant"
  version: "1.0.0"
  debug: false

ocr:
  engine: "paddleocr"
  languages: ["ch", "en"]
  confidence_threshold: 0.8
  use_gpu: false
  angle_classification: true

ai:
  provider: "zhipu"
  model: "glm-4.5-flash"
  api_key_env: "ZHIPU_API_KEY"  # ç¯å¢ƒå˜é‡å
  temperature: 0.7
  top_p: 0.8
  max_tokens: 2000
  retry_times: 3
  timeout: 30

paths:
  input_images: "D:/360MoveData/Users/wukon/Pictures/7ä¸Šè‹±è¯­"
  output_base: "./output"
  cache_dir: "./cache"
  log_dir: "./logs"

processing:
  batch_size: 10
  max_workers: 5
  enable_cache: true
  
quality:
  ocr_confidence_min: 0.8
  manual_review_threshold: 0.9
```

#### é…ç½®åŠ è½½ç±»
```python
import yaml
import os
from typing import Dict, Any

class Config:
    def __init__(self, config_path: str = "config/config.yaml"):
        with open(config_path, 'r', encoding='utf-8') as f:
            self._config = yaml.safe_load(f)
        
        # åŠ è½½ç¯å¢ƒå˜é‡
        self._load_env_vars()
    
    def _load_env_vars(self):
        """ä»ç¯å¢ƒå˜é‡åŠ è½½æ•æ„Ÿé…ç½®"""
        api_key_env = self._config['ai']['api_key_env']
        api_key = os.getenv(api_key_env)
        if not api_key:
            raise ValueError(f"Environment variable {api_key_env} not found")
        self._config['ai']['api_key'] = api_key
    
    def get(self, key_path: str, default=None) -> Any:
        """è·å–åµŒå¥—é…ç½®å€¼ï¼Œå¦‚ 'ai.model'"""
        keys = key_path.split('.')
        value = self._config
        for key in keys:
            value = value.get(key, {})
            if not isinstance(value, dict) and key != keys[-1]:
                return default
        return value if value != {} else default
```

### 7. æ—¥å¿—ç®¡ç†æ–¹æ¡ˆ

#### Loguruæ—¥å¿—é…ç½®
```python
from loguru import logger
import sys

def setup_logging(config: Config):
    # ç§»é™¤é»˜è®¤handler
    logger.remove()
    
    # æ§åˆ¶å°è¾“å‡º
    logger.add(
        sys.stdout,
        format="<green>{time:YYYY-MM-DD HH:mm:ss}</green> | <level>{level: <8}</level> | <cyan>{name}</cyan>:<cyan>{function}</cyan>:<cyan>{line}</cyan> - <level>{message}</level>",
        level="INFO" if not config.get('app.debug') else "DEBUG"
    )
    
    # æ–‡ä»¶è¾“å‡º
    log_dir = config.get('paths.log_dir', './logs')
    logger.add(
        f"{log_dir}/app.log",
        rotation="1 day",
        retention="30 days",
        compression="zip",
        format="{time:YYYY-MM-DD HH:mm:ss} | {level: <8} | {name}:{function}:{line} - {message}",
        level="DEBUG"
    )
    
    # é”™è¯¯æ—¥å¿—å•ç‹¬è®°å½•
    logger.add(
        f"{log_dir}/error.log",
        level="ERROR",
        rotation="1 week",
        retention="12 weeks"
    )
```

### 8. é¡¹ç›®ç»“æ„è®¾è®¡

```
English-girl-learning/
â”œâ”€â”€ config/                 # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ config.yaml        # ä¸»é…ç½®
â”‚   â””â”€â”€ prompts.yaml       # AIæç¤ºè¯é…ç½®
â”œâ”€â”€ src/                   # æºä»£ç 
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ ocr/              # OCRæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ paddle_ocr.py
â”‚   â”‚   â””â”€â”€ preprocessor.py
â”‚   â”œâ”€â”€ ai/               # AIå¤„ç†æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ zhipu_client.py
â”‚   â”‚   â””â”€â”€ prompts.py
â”‚   â”œâ”€â”€ document/         # æ–‡æ¡£ç”Ÿæˆæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ markdown_gen.py
â”‚   â”‚   â””â”€â”€ templates/
â”‚   â”œâ”€â”€ utils/            # å·¥å…·æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ config.py
â”‚   â”‚   â””â”€â”€ logging.py
â”‚   â””â”€â”€ main.py          # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ tests/               # æµ‹è¯•ç”¨ä¾‹
â”œâ”€â”€ output/              # è¾“å‡ºç›®å½•
â”œâ”€â”€ cache/               # ç¼“å­˜ç›®å½•
â”œâ”€â”€ logs/                # æ—¥å¿—ç›®å½•
â”œâ”€â”€ requirements.txt     # ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ requirements-dev.txt # å¼€å‘ä¾èµ–
â”œâ”€â”€ setup.py            # å®‰è£…è„šæœ¬
â””â”€â”€ README.md           # é¡¹ç›®è¯´æ˜
```

## éƒ¨ç½²å’Œè¿è¡Œè¦æ±‚

### ç³»ç»Ÿè¦æ±‚
- **æ“ä½œç³»ç»Ÿ**: Windows 10+, macOS 10.15+, Ubuntu 18.04+
- **Pythonç‰ˆæœ¬**: 3.8+
- **å†…å­˜**: æœ€å°4GBï¼Œæ¨è8GB+
- **å­˜å‚¨**: å¯ç”¨ç©ºé—´2GB+ï¼ˆæ¨¡å‹æ–‡ä»¶ï¼‰

### å®‰è£…éƒ¨ç½²
```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/user/English-girl-learning.git
cd English-girl-learning

# 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 3. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 4. è®¾ç½®ç¯å¢ƒå˜é‡
export ENGLISH_LEARNING_ZHIPU_API_KEY="your-api-key-here"

# 5. è¿è¡Œç¨‹åº
python src/main.py
```

## æ€§èƒ½é¢„æœŸ

### å¤„ç†é€Ÿåº¦ä¼°ç®—
- **OCRè¯†åˆ«**: ~2-3ç§’/å¼ å›¾ç‰‡
- **AIåˆ†æ**: ~5-10ç§’/é¡µå†…å®¹
- **æ–‡æ¡£ç”Ÿæˆ**: <1ç§’/æ–‡æ¡£
- **æ•´ä½“æµç¨‹**: ~50-100å¼ å›¾ç‰‡/å°æ—¶

### æˆæœ¬ä¼°ç®—
- **è®¡ç®—æˆæœ¬**: æœ¬åœ°OCRæ— é¢å¤–è´¹ç”¨
- **AIè°ƒç”¨**: åŸºäºæ™ºæ™®AIå®šä»·ï¼Œé¢„ä¼°æ¯æœ¬æ•™æ<10å…ƒ
- **å­˜å‚¨æˆæœ¬**: æœ¬åœ°å­˜å‚¨ï¼ŒåŸºæœ¬æ— æˆæœ¬