# 英语学习助手 - 项目配置管理文档

## 📋 文档概述

**文档版本**: v2.0.0  
**创建时间**: 2025-08-29  
**最后更新**: 2025-08-29  
**维护人员**: Claude Code Assistant  
**适用版本**: v1.8.0 (稳定版) & v2.0.0 (测试版)  

---

## 🏗️ 项目基础配置

### 项目基本信息
```yaml
项目名称: 英语学习助手 (English Learning Assistant)
项目类型: Web应用 (Streamlit)
主要功能: AI驱动的英语教材OCR识别与智能分析
技术架构: Python + Streamlit + GLM-4V-Flash + GitHub图床
开发模式: 敏捷开发 + 分支管理
部署方式: Streamlit Cloud自动部署
```

### 目录结构配置
```
English-girl-learning/
├── 📁 src/                          # 源代码目录
│   ├── 📁 core/                     # 核心业务逻辑
│   │   ├── ai_analyzer.py          # AI分析器 (GLM-4V-Flash)
│   │   ├── vision_processor.py     # 视觉处理器
│   │   └── document_generator.py   # 文档生成器
│   ├── 📁 ui/                      # 用户界面
│   │   └── main_interface.py       # 主界面 (Streamlit)
│   └── 📁 utils/                   # 工具模块
│       └── config.py               # 配置管理
├── 📁 temp_images/                 # 临时图片存储 (GitHub图床)
├── 📁 static/                      # 静态文件 (v2.0已移除)
├── 📁 output/                      # 输出文件目录
├── 📁 docs/                       # 项目文档
├── 📄 streamlit_app.py            # 应用入口点
├── 📄 requirements.txt            # Python依赖配置
├── 📄 .gitignore                  # Git忽略文件配置
├── 📄 README.md                   # 项目说明文档
├── 📄 CHANGELOG.md                # 版本更新日志
├── 📄 版本差异对比-v1.8.0-vs-v2.0.0.md  # 版本对比文档
├── 📄 分支管理策略.md              # 分支管理说明
└── 📄 项目配置管理文档.md          # 本配置文档
```

---

## 🔧 环境配置管理

### 1. Python环境配置

#### 基础环境要求
```yaml
Python版本: ">= 3.8, < 3.13"
包管理器: pip
虚拟环境: 推荐使用
操作系统: Windows/Linux/macOS (跨平台)
```

#### 依赖包配置 (requirements.txt)
```txt
# 核心框架
streamlit>=1.28.0              # Web应用框架
zhipuai>=2.0.0                 # 智普AI SDK

# 图像处理  
Pillow>=10.0.0                 # 图像处理库
opencv-python>=4.8.0          # 计算机视觉 (可选)

# 数据处理
pandas>=2.0.0                 # 数据分析 (可选)
numpy>=1.24.0                 # 数值计算 (可选)

# 网络请求
requests>=2.31.0              # HTTP请求库
httpx>=0.25.0                 # 现代HTTP客户端

# 文档生成  
markdown>=3.5.0               # Markdown处理

# 系统工具
pathlib                       # 路径处理 (内置)
tempfile                     # 临时文件 (内置)
time                         # 时间处理 (内置)
os                           # 系统接口 (内置)
```

### 2. 环境变量配置

#### 必需环境变量
```bash
# AI服务配置
ENGLISH_LEARNING_ZHIPU_API_KEY="your_zhipu_api_key_here"

# GitHub图床配置 (可选，用于图片托管)
GITHUB_TOKEN="your_github_token_here"

# 应用配置 (可选)
STREAMLIT_SERVER_PORT=8501
STREAMLIT_SERVER_ADDRESS=localhost
```

#### 配置方式

**方式1: 系统环境变量**
```bash
# Windows
set ENGLISH_LEARNING_ZHIPU_API_KEY=your_key_here

# Linux/macOS  
export ENGLISH_LEARNING_ZHIPU_API_KEY=your_key_here
```

**方式2: Streamlit Cloud配置**
```yaml
# 在Streamlit Cloud后台设置
Environment Variables:
  ENGLISH_LEARNING_ZHIPU_API_KEY: your_key_here
  GITHUB_TOKEN: your_token_here
```

**方式3: .env文件 (开发环境)**
```env
# .env (不提交到Git)
ENGLISH_LEARNING_ZHIPU_API_KEY=your_key_here
GITHUB_TOKEN=your_token_here
```

---

## 🔀 版本控制配置

### Git配置

#### .gitignore配置
```gitignore
# Python
__pycache__/
*.py[cod]
*.pyo
*.pyd
.Python
*.so
.venv/
.env

# Streamlit
.streamlit/secrets.toml

# 临时文件
*.tmp
*.temp
temp/
output/*.txt
output/*.md

# 系统文件
.DS_Store
Thumbs.db

# IDE
.vscode/
.idea/
*.swp
*.swo

# 日志
*.log

# 敏感信息
secrets.toml
config.ini
```

#### 分支策略配置
```yaml
主分支策略:
  main: 生产稳定版本
  develop: 开发集成分支 (未启用)
  
版本分支策略:
  格式: "v{major}.{minor}-{feature}"
  示例: "v2.0-ui-redesign"
  用途: 重大版本开发
  
功能分支策略:
  格式: "feature-{功能名}"
  示例: "feature-语音识别"
  用途: 新功能开发
  
修复分支策略:
  格式: "hotfix-{问题描述}"  
  示例: "hotfix-api调用失败"
  用途: 紧急问题修复
```

### 提交规范配置

#### 提交消息格式
```
<类型>(<范围>): <简短描述>

<详细描述>

<脚注>
```

#### 类型定义
- **feat**: 新功能
- **fix**: Bug修复  
- **docs**: 文档更新
- **style**: 代码格式调整
- **refactor**: 代码重构
- **test**: 测试相关
- **chore**: 构建/配置相关

#### 示例提交
```
feat(ui): 实现左右分栏布局设计

- 添加现代化的左右分栏界面
- 左侧显示识别文本内容
- 右侧显示图片缩略图列表  
- 支持文件切换和实时预览

Closes #123
```

---

## 🚀 部署配置管理

### Streamlit Cloud部署配置

#### 应用配置文件 (.streamlit/config.toml)
```toml
[global]
developmentMode = false

[server]
headless = true
port = 8501
enableCORS = false
enableXsrfProtection = false

[theme]
primaryColor = "#FF6B6B"
backgroundColor = "#FFFFFF"  
secondaryBackgroundColor = "#F0F2F6"
textColor = "#262730"

[browser]
gatherUsageStats = false
```

#### Streamlit应用入口配置
```python
# streamlit_app.py
"""
英语学习助手 - Streamlit应用入口点
"""

import sys
import os
from pathlib import Path

# 禁用系统代理，避免部署问题
os.environ.pop('HTTP_PROXY', None)
os.environ.pop('HTTPS_PROXY', None)

# 设置API密钥 (生产环境从环境变量获取)
if not os.getenv("ENGLISH_LEARNING_ZHIPU_API_KEY"):
    # 开发环境默认密钥
    os.environ["ENGLISH_LEARNING_ZHIPU_API_KEY"] = "your_dev_key"

# 添加项目路径
project_root = Path(__file__).parent
sys.path.insert(0, str(project_root))

# 启动应用
from src.ui.main_interface import create_main_interface

def main():
    interface = create_main_interface()
    interface.run()

if __name__ == "__main__":
    main()
```

### 监控与日志配置

#### 应用监控配置
```yaml
健康检查:
  - URL: https://engirl.streamlit.app
  - 检查间隔: 5分钟
  - 超时时间: 30秒
  - 预期响应: 200 OK

性能监控:
  - 响应时间: < 3秒
  - 内存使用: < 512MB
  - CPU使用: < 80%
  - 错误率: < 1%
```

#### 日志配置
```python
# 日志级别配置
import logging

# 生产环境
logging.basicConfig(
    level=logging.WARNING,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)

# 开发环境  
logging.basicConfig(
    level=logging.DEBUG,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)
```

---

## 📊 数据配置管理

### 数据存储配置

#### 临时数据存储
```yaml
GitHub图床:
  仓库: siqi-2025/English-girl-learning
  分支: main
  目录: temp_images/
  清理策略: 手动清理
  大小限制: 100MB per file
  格式限制: JPG, PNG, BMP, TIFF

本地临时存储:
  目录: ./temp/
  清理策略: 程序退出时自动清理
  大小限制: 1GB total
  保存时间: 会话期间
```

#### 输出文件配置
```yaml
文档输出:
  目录: ./output/
  格式: Markdown (.md)
  命名: english_learning_export_{timestamp}.md
  编码: UTF-8
  大小限制: 50MB per file

图片输出:
  格式: JPG (GitHub图床标准)
  质量: 95%
  最大分辨率: 4096x4096
  颜色模式: RGB
```

### API配置管理

#### GLM-4V-Flash API配置
```yaml
基础配置:
  模型: "glm-4v-flash"
  基础URL: "https://open.bigmodel.cn/api/paas/v4/"
  超时时间: 30秒
  重试次数: 3次

参数配置:
  temperature: 0.8      # 生成温度
  top_p: 0.6           # 核采样参数  
  max_tokens: 1024     # 最大输出长度
  stream: false        # 禁用流式输出

请求格式:
  Content-Type: "application/json"
  Authorization: "Bearer {api_key}"
  User-Agent: "English-Learning-Assistant/2.0"
```

#### GitHub API配置 (图床服务)
```yaml
基础配置:
  API版本: "v3"
  基础URL: "https://api.github.com"
  超时时间: 30秒
  重试次数: 3次

认证配置:
  方式: Personal Access Token
  权限: repo (完整仓库访问)
  作用域: public_repo + repo

上传配置:
  分支: main
  提交信息: "Upload temp image for GLM-4V-Flash processing"
  文件名格式: "temp_image_{timestamp}.jpg"
```

---

## 🔒 安全配置管理

### API密钥安全配置

#### 密钥管理策略
```yaml
开发环境:
  存储方式: .env文件 (不提交)
  轮换策略: 每月轮换
  权限控制: 只读API权限
  
生产环境:
  存储方式: Streamlit Cloud环境变量
  轮换策略: 每季度轮换  
  权限控制: 最小必要权限
  监控: API使用量监控

测试环境:
  存储方式: 测试专用密钥
  轮换策略: 每次测试轮换
  权限控制: 受限API权限
```

#### 敏感信息保护
```python
# 密钥脱敏显示
def mask_api_key(key: str) -> str:
    if not key or len(key) < 8:
        return "***"
    return key[:4] + "*" * (len(key) - 8) + key[-4:]

# 使用示例
api_key = os.getenv("ENGLISH_LEARNING_ZHIPU_API_KEY")
print(f"使用API密钥: {mask_api_key(api_key)}")
```

### 文件上传安全配置

#### 文件类型限制
```python
ALLOWED_EXTENSIONS = {'.jpg', '.jpeg', '.png', '.bmp', '.tiff'}
MAX_FILE_SIZE = 100 * 1024 * 1024  # 100MB
MAX_FILES_PER_BATCH = 10

def is_allowed_file(filename: str, file_size: int) -> bool:
    # 检查扩展名
    if not any(filename.lower().endswith(ext) for ext in ALLOWED_EXTENSIONS):
        return False
    
    # 检查文件大小  
    if file_size > MAX_FILE_SIZE:
        return False
        
    return True
```

#### 内容安全检查
```python
def validate_image_content(file_data: bytes) -> bool:
    """验证图片内容安全性"""
    try:
        from PIL import Image
        import io
        
        # 验证是否为有效图片
        with Image.open(io.BytesIO(file_data)) as img:
            # 检查图片模式
            if img.mode not in ['RGB', 'RGBA', 'L']:
                return False
                
            # 检查图片尺寸  
            if img.size[0] > 4096 or img.size[1] > 4096:
                return False
                
        return True
    except Exception:
        return False
```

---

## 📈 性能配置管理

### 应用性能配置

#### 缓存配置
```python
import streamlit as st

# Streamlit缓存配置
@st.cache_data(ttl=3600)  # 1小时缓存
def cached_api_call(image_url: str):
    """缓存API调用结果"""
    pass

@st.cache_resource  # 全局资源缓存
def load_ai_client():
    """缓存AI客户端实例"""
    pass
```

#### 资源限制配置  
```yaml
内存限制:
  开发环境: 1GB
  生产环境: 512MB  
  警告阈值: 80%
  自动清理: 90%

CPU限制:
  最大使用率: 80%
  并发请求: 10个
  请求队列: 50个
  超时时间: 60秒

网络配置:
  连接超时: 10秒
  读取超时: 30秒  
  总超时: 60秒
  最大重试: 3次
```

### 数据库配置 (未来扩展)

#### SQLite配置 (用户数据存储)
```yaml
数据库文件: ./data/app.db
连接池大小: 10
超时时间: 30秒
WAL模式: 启用
自动备份: 每日

表结构:
  users: 用户信息
  sessions: 会话记录  
  processed_images: 处理历史
  export_logs: 导出记录
```

---

## 🧪 测试配置管理

### 测试环境配置

#### 单元测试配置
```yaml
测试框架: pytest
覆盖率工具: pytest-cov  
最小覆盖率: 80%
测试目录: ./tests/
测试命名: test_*.py
```

#### 测试数据配置
```yaml
测试图片:
  位置: ./tests/fixtures/images/
  格式: JPG, PNG
  大小: 1KB - 10MB
  数量: 20个样本
  类型: 英语教材截图

测试API:
  模拟服务: 启用
  测试密钥: test_key_only
  响应延迟: 100ms
  错误模拟: 10%概率
```

### 持续集成配置 (GitHub Actions)

#### CI/CD流程配置
```yaml
# .github/workflows/ci.yml
name: CI/CD Pipeline

on:
  push:
    branches: [ main, v*-* ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'
      - name: Install dependencies
        run: pip install -r requirements.txt
      - name: Run tests
        run: pytest --cov=src --cov-report=xml
      - name: Upload coverage
        uses: codecov/codecov-action@v3
```

---

## 📋 配置管理检查清单

### 部署前检查
- [ ] **环境变量**
  - [ ] ENGLISH_LEARNING_ZHIPU_API_KEY 已设置
  - [ ] GITHUB_TOKEN 已设置 (可选)
  - [ ] 其他必需环境变量已配置

- [ ] **依赖包**  
  - [ ] requirements.txt 已更新
  - [ ] 所有依赖包版本已固定
  - [ ] 安全漏洞扫描通过

- [ ] **代码配置**
  - [ ] 调试代码已清理
  - [ ] 硬编码密钥已移除  
  - [ ] 生产配置已启用

### 安全检查
- [ ] **敏感信息**
  - [ ] API密钥不在代码中硬编码
  - [ ] .env文件已添加到.gitignore
  - [ ] secrets.toml未提交到版本控制

- [ ] **文件上传**
  - [ ] 文件类型限制已启用
  - [ ] 文件大小限制已设置
  - [ ] 恶意文件检测已配置

### 性能检查  
- [ ] **缓存配置**
  - [ ] API调用缓存已启用
  - [ ] 静态资源缓存已配置
  - [ ] 缓存过期策略已设置

- [ ] **资源限制**
  - [ ] 内存使用监控已启用
  - [ ] 并发请求限制已设置
  - [ ] 超时配置已优化

### 监控检查
- [ ] **日志配置**
  - [ ] 生产环境日志级别已设置
  - [ ] 错误日志已配置
  - [ ] 性能日志已启用

- [ ] **健康检查**  
  - [ ] 应用健康检查端点已配置
  - [ ] 监控告警已设置
  - [ ] 故障恢复流程已准备

---

## 📞 配置支持与维护

### 配置文件维护

#### 定期检查任务 (月度)
- [ ] 检查依赖包安全更新
- [ ] 更新API密钥轮换
- [ ] 清理过期的临时文件
- [ ] 验证备份和恢复流程

#### 版本升级任务 (季度)  
- [ ] 评估新版本Streamlit兼容性
- [ ] 更新Python版本要求
- [ ] 优化性能配置参数
- [ ] 更新安全配置策略

### 问题处理流程

#### 配置问题诊断
1. **环境变量问题**
   - 检查变量是否存在
   - 验证变量值格式
   - 确认变量作用域

2. **依赖包问题**
   - 检查包版本兼容性
   - 验证包安装完整性  
   - 解决包冲突问题

3. **API配置问题**
   - 验证API密钥有效性
   - 检查网络连接状态
   - 确认API限制和配额

#### 紧急配置修复
```bash
# 快速回滚配置
git checkout HEAD~1 -- requirements.txt
git checkout HEAD~1 -- .streamlit/config.toml

# 重启服务
streamlit run streamlit_app.py --server.port 8501
```

---

## 📝 配置管理总结

本配置管理文档涵盖了英语学习助手项目从开发到生产的完整配置体系。通过规范化的配置管理，我们确保了：

✅ **开发效率**: 标准化的开发环境配置  
✅ **部署稳定**: 自动化的部署流程配置  
✅ **运行安全**: 全面的安全防护配置  
✅ **性能优化**: 科学的性能调优配置  
✅ **质量保证**: 严格的测试验证配置

随着项目的发展，此文档将持续更新和完善，为项目的长期稳定运行提供强有力的配置管理支撑。

**文档维护**: 每次重大版本发布后更新  
**配置审查**: 每季度进行全面审查  
**安全更新**: 每月检查安全配置更新